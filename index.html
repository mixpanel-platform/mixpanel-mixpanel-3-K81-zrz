<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="https://cdn.mxpnl.com/libs/mixpanel-platform/css/reset.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.mxpnl.com/libs/mixpanel-platform/build/mixpanel-platform.v0.latest.min.css">
    <script src="https://code.jquery.com/jquery-2.2.0.min.js"></script>
        <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    
    <script src="//cdn.datatables.net/1.10.9/js/jquery.dataTables.min.js"></script>
    <link rel="stylesheet" type="text/css" href="//cdn.datatables.net/1.10.9/css/jquery.dataTables.min.css">
    <script src="https://cdn.mxpnl.com/libs/mixpanel-platform/build/mixpanel-platform.v0.latest.min.js"></script>
  </head>
  <body class="mixpanel-platform-body">
      <div class='row'>
        <div id="leadSelect" style="float: left; height:36px !important;"></div>
        <div id="by" class="mixpanel-platform-label" style="margin-left: 10px; display: none;">by</div>
        <div id="dateSelect" style="float: right;"></div>
      </div>
      <div class="row">
                  <div class="col-lg-12">
                     <div class="panel panel-default">
                        <div class="panel-heading text-center">
                           Pricing Page Table
                        </div>
                        <div class="panel-body">
                         <div id="datatable1_wrapper" class="dataTables_wrapper form-inline no-footer">
                          <div class="row">
                            <div class="col-xs-6">
                              <div class="dataTables_length" id="datatable1_length"></div></div><div class="col-xs-6"><div id="datatable1_filter" class="dataTables_filter"></div></div></div>
                                <table id="datatable1" class="table table-striped table-hover dataTable no-footer" role="grid" aria-describedby="datatable1_info">
                              	  <thead>
	                                <tr role="row">
	                                  <th class="sorting_asc" tabindex="0" aria-controls="datatable1" rowspan="1" colspan="1" aria-sort="ascending" aria-label="Rendering engine: activate to sort column descending" style="width: 161px;">Lead Email</th>
	                                  <th class="sorting" tabindex="0" aria-controls="datatable1" rowspan="1" colspan="1" aria-label="Browser: activate to sort column ascending" style="width: 237px;">Pricing Page Views</th>
                                      <!--<th class="sorting" tabindex="0" aria-controls="datatable1" rowspan="1" colspan="1" aria-label="Platform(s): activate to sort column ascending" style="width: 211px;">Platform(s)</th>
                                      <th class="sort-numeric sorting" tabindex="0" aria-controls="datatable1" rowspan="1" colspan="1" aria-label="Engine version: activate to sort column ascending" style="width: 135px;">Engine version</th>
                                      <th class="sort-alpha sorting" tabindex="0" aria-controls="datatable1" rowspan="1" colspan="1" aria-label="CSS grade: activate to sort column ascending" style="width: 97px;">CSS grade</th>-->
                                   	</tr>
                                  </thead>
                                  <tbody>
                                  		
                                  </tbody>
                                </table>
                                <div class="row">
                                    <div class="col-xs-6">
                                        <div class="dataTables_info" id="datatable1_info" role="status" aria-live="polite">
                                        </div>
                                    </div>
                                    <div class="col-xs-6">
                                        <div class="dataTables_paginate paging_simple_numbers" id="datatable1_paginate">
                                            
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                     </div>
                  </div>
               </div>
    
    <div id="table"></div>
    <script>
      
      var options = {
          items: [
            {label: 'Label 1', value: 1},
            {label: 'Label 2', value: 'Value 2'},
            {label: 'Third label', value: '3rd value'}
          ]
        };

      $(document).ready(function() {
        /* Query for all Mixpanel Sales reps first */
        var repData = {
          'items': [
            ]
        }
        var queryLeads = MP.api.query('/api/2.0/segmentation/', {event: 'View pricing page', on: 'user["Lead owner name"]', unit: 'month'}, {dataType: 'json'})

        queryLeads.done(function(json) {
            var mixpanelReps = _.keys(json.data.values);
            console.log(mixpanelReps);
            _.each(mixpanelReps, function(rep){
              repData.items.push({'label': rep, 'value': rep});
             
            })
            var dropdown = $('#leadSelect').MPSelect(options); 
            var dateSelect  = $('#dateSelect').MPDatepicker();
            
        })
       
        
        dropdown.on('change', function(e, selection) {                         
            alert(selection);
        });
        dateSelect.on('change', function(e, selection){
          alert(selection);
        })
          
      });
      

      var runQuery = function() {
        
        
        drawTable();
      }
      
      var drawTable = function(){
        var table = $('#datatable1').DataTable();
        /* Clear it before we Draw Again */
        table.clear();
        /* 
        _.each(_.keys(data), function(datum){
            table.row.add([datum,data[datum]]).draw(false);
        });
        
        table.order([1, 'desc']).draw();
        */

      }
      
      /*
          var leadOwner = eventSelect.MPEventSelect('value'),
            propName  = propSelect.MPPropertySelect('value'),
            dateRange = dateSelect.MPDatepicker('value');
      

        if (eventName) {
          MP.api.segment(eventName, propName, dateRange).done(function(results) {
            eventGraph.MPChart('setData', results);
            eventTable.MPTable('setData', results);
          });
        }
      };
      eventSelect.on('change', function(e, eventName) {
        propSelect.MPPropertySelect('setEvent', eventName);
        $("#by").show();
        runQuery();
      });
      propSelect.on('change', runQuery);
      dateSelect.on('change', runQuery);
      */
      
      runQuery();
    </script>
  </body>
</html>
